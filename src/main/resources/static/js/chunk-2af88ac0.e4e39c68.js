(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2af88ac0"],{"284b":function(e,t,a){"use strict";a("d3b7");var r=a("bc3a"),s=a.n(r),o=a("a18c"),i=a("5c96"),l=s.a.create({baseURL:"http://e7s6ux.natappfree.cc"});l.interceptors.request.use((function(e){var t=localStorage.getItem("token");return t?e.headers.token=t:o["a"].push("/login"),e}),(function(e){return Promise.reject(e)})),l.interceptors.response.use((function(e){if(e.data.code)switch(e.data.code){case 4004:window.localStorage.removeItem("token"),window.localStorage.removeItem("info"),o["a"].push("/login").catch((function(e){console.log(e)}));break;case 4003:Object(i["Message"])({showClose:!0,message:"权限不足",type:"warning"});break}return e}),(function(e){return Promise.reject(e.response.status)})),t["a"]=l},"863c":function(e,t,a){"use strict";a("dec2")},c57a:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.allLoading?e._e():a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.allLoading,expression:"allLoading"}],staticClass:"user-main"},[a("div",{staticClass:"user-main-left"},[a("div",{staticClass:"user-main-left-content"},[a("el-tree",{attrs:{data:e.deptData,"node-key":"id",props:e.defaultProps,"expand-on-click-node":!1,"default-expand-all":"",draggable:"","allow-drop":e.allowDrop,"allow-drag":e.allowDrag},on:{"node-click":e.handleNodeClick,"node-drop":e.handleDrop},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,s=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(r.label))]),a("span",[1==s.canEdit?a("el-dropdown",[a("span",{staticClass:"el-dropdown-link"},[a("i",{staticClass:"el-icon-more el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(t){return e.append(r)}}},[a("span",[e._v("新增")])]),a("el-dropdown-item",{nativeOn:{click:function(t){return e.remove(r)}}},[a("span",[e._v("删除")])]),a("el-dropdown-item",{nativeOn:{click:function(t){return e.updateName(s)}}},[a("span",[e._v("修改")])]),a("el-dropdown-item",{nativeOn:{click:function(t){return e.setPrincipal(s)}}},[a("span",[e._v("设置负责人")])])],1)],1):e._e()],1)])}}],null,!1,2280138974)}),a("el-dialog",{attrs:{width:"30%",title:"新增部门",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"deptForm",attrs:{model:e.deptForm,rules:e.deptRule}},[a("el-form-item",{attrs:{label:"部门名称",prop:"deptName"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.deptForm.deptName,callback:function(t){e.$set(e.deptForm,"deptName",t)},expression:"deptForm.deptName"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitAddDept("deptForm")}}},[e._v("立即创建 ")]),a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")])],1)],1),a("el-dialog",{attrs:{width:"30%",title:"修改部门",visible:e.dialogUpdateVisible},on:{"update:visible":function(t){e.dialogUpdateVisible=t}}},[a("el-form",{ref:"updateDeptForm",attrs:{model:e.updateDeptForm,rules:e.deptRule}},[a("el-form-item",{attrs:{label:"部门名称",prop:"deptName"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.updateDeptForm.deptName,callback:function(t){e.$set(e.updateDeptForm,"deptName",t)},expression:"updateDeptForm.deptName"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitUpdateDept("updateDeptForm")}}},[e._v("立即修改 ")]),a("el-button",{on:{click:function(t){e.dialogUpdateVisible=!1}}},[e._v("取 消")])],1)],1),a("el-dialog",{attrs:{width:"50%",title:"设置部门负责人",visible:e.dialogSetPrincipalVisible},on:{"update:visible":function(t){e.dialogSetPrincipalVisible=t}}},[a("div",{staticClass:"set-principal-dialog"},[a("div",{staticClass:"set-principal-dialog-left"},[a("el-form",{attrs:{model:e.setPrincipalForm}},[a("el-form-item",{attrs:{prop:"deptName"}},[a("el-select",{staticStyle:{width:"90%"},attrs:{multiple:"",filterable:"",remote:"","reserve-keyword":"","collapse-tags":"",placeholder:"请输入姓名或账号以搜索...","remote-method":e.remoteMethod,loading:e.loading},on:{change:e.change},model:{value:e.setPrincipalForm.userIds,callback:function(t){e.$set(e.setPrincipalForm,"userIds",t)},expression:"setPrincipalForm.userIds"}},e._l(e.options,(function(e){return a("el-option",{key:e.userId,attrs:{disabled:e.disabled,label:e.realName+"-"+e.account,value:e.userId}})})),1)],1)],1)],1),a("div",{staticClass:"set-principal-dialog-right"},[a("div",{staticClass:"set-principal-dialog-right-top"},[a("h3",[e._v("已选择人员:")]),e._l(e.selectNames,(function(t){return a("el-tag",{key:t,attrs:{type:"info"}},[e._v(e._s(t))])}))],2),a("div",{staticClass:"set-principal-dialog-right-bottom"},[a("h3",[e._v("已有人员:")]),e._l(e.selectedNames,(function(t){return a("el-tag",{key:t.baseInfoId,attrs:{closable:"",type:"success"},on:{close:function(a){return e.closeTag(t.myUserId)}}},[e._v(e._s(t.realName)+" ")])}))],2)])]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",disabled:e.selectNames.length<1},on:{click:e.submitPrincipalDept}},[e._v("确定 ")]),a("el-button",{on:{click:function(t){e.dialogSetPrincipalVisible=!1}}},[e._v("取 消")])],1)])],1)]),a("div",{staticClass:"user-main-right"},[1==e.deptData[0].canEdit?a("div",{staticClass:"user-tool"},[a("div",[a("el-button",{attrs:{type:"success"},on:{click:function(t){e.addUserPanel=!e.addUserPanel}}},[e._v("添加用户"),a("i",{staticClass:"el-icon-circle-plus el-icon--right"})]),a("el-button",{attrs:{type:"primary"}},[e._v("批量导入"),a("i",{staticClass:"el-icon-upload el-icon--right"})])],1)]):e._e(),a("div",{staticClass:"user-content"},[e.addUserPanel?a("div",[a("el-table",{staticStyle:{width:"95%",margin:"0 auto"},attrs:{"max-height":"750px",data:e.tableData.filter((function(t){return!e.search||t.realName.toLowerCase().includes(e.search.toLowerCase())}))}},[a("el-table-column",{attrs:{label:"账号",prop:"account"}}),a("el-table-column",{attrs:{label:"姓名",prop:"realName"}}),a("el-table-column",{attrs:{label:"性别"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(0==t.row.gender?"女":"男")+" ")]}}],null,!1,2444679955)}),a("el-table-column",{attrs:{label:"与户主关系"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.relation)+" "),t.row.host?a("i",{staticClass:"el-icon-s-custom",staticStyle:{color:"wheat"}}):e._e()]}}],null,!1,1823998530)}),a("el-table-column",{attrs:{label:"手机",prop:"phone"}}),a("el-table-column",{attrs:{label:"地址",prop:"addr"}}),a("el-table-column",{attrs:{label:"组织",prop:"deptName"}}),a("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"header",fn:function(t){return[a("el-input",{attrs:{size:"mini",placeholder:"输入姓名搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}},{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",round:""},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑 ")]),1==e.deptData[0].canEdit?a("el-button",{attrs:{size:"mini",type:"danger",round:""},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除 ")]):e._e()]}}],null,!1,901229621)},[e._v(" eslint-disable ")])],1)],1):a("div",{staticClass:"add-user"},[a("el-form",{ref:"addUserForm",staticClass:"demo-ruleForm",attrs:{model:e.addUserForm,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"账号",prop:"username"}},[a("el-input",{model:{value:e.addUserForm.username,callback:function(t){e.$set(e.addUserForm,"username",t)},expression:"addUserForm.username"}})],1),a("el-form-item",{attrs:{label:"真实姓名",prop:"realName"}},[a("el-input",{model:{value:e.addUserForm.realName,callback:function(t){e.$set(e.addUserForm,"realName",t)},expression:"addUserForm.realName"}})],1),a("el-form-item",{attrs:{label:"组织架构",prop:"dept"}},[a("el-cascader",{attrs:{options:e.deptData,props:{expandTrigger:"hover",checkStrictly:!0,value:"id"}},model:{value:e.addUserForm.dept,callback:function(t){e.$set(e.addUserForm,"dept",t)},expression:"addUserForm.dept"}})],1),a("el-form-item",{attrs:{label:"手机",prop:"phone"}},[a("el-input",{model:{value:e.addUserForm.phone,callback:function(t){e.$set(e.addUserForm,"phone",t)},expression:"addUserForm.phone"}})],1),a("el-form-item",{attrs:{label:"性别",prop:"gender"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"男","inactive-text":"女"},model:{value:e.addUserForm.gender,callback:function(t){e.$set(e.addUserForm,"gender",t)},expression:"addUserForm.gender"}})],1),a("el-form-item",{attrs:{label:"住址",prop:"addr"}},[a("el-input",{model:{value:e.addUserForm.addr,callback:function(t){e.$set(e.addUserForm,"addr",t)},expression:"addUserForm.addr"}})],1),a("el-form-item",{attrs:{label:"是否户主",prop:"isHost"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"是","inactive-text":"否"},model:{value:e.addUserForm.isHost,callback:function(t){e.$set(e.addUserForm,"isHost",t)},expression:"addUserForm.isHost"}})],1),a("el-form-item",{attrs:{label:"与户主关系",prop:"relation"}},[a("el-input",{attrs:{disabled:e.addUserForm.isHost},model:{value:e.addUserForm.relation,callback:function(t){e.$set(e.addUserForm,"relation",t)},expression:"addUserForm.relation"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("addUserForm")}}},[e._v("立即创建")]),a("el-button",{on:{click:function(t){return e.resetForm("addUserForm")}}},[e._v("重置")])],1)],1)],1)])])])},s=[],o=a("284b"),i={data:function(){return{allLoading:!0,search:"",defaultProps:{children:"children",label:"label",value:"id"},deptData:[],tableData:[],ids:[],addUserPanel:!0,addUserForm:{username:"",realName:"",phone:"",gender:!0,addr:"",isHost:!1,relation:this.isHost?"户主":"",dept:[]},rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"},{min:5,max:20,message:"长度在 5 到 20 个字符",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:10,message:"长度在 2 到 10 个字符",trigger:"blur"}],dept:[{required:!0,message:"请选择部门",trigger:"change"}],phone:[{required:!0,message:"请输入手机",trigger:"blur"},{pattern:/^1[34578]\d{9}$/,message:"目前只支持中国大陆的手机号码"}],addr:[{required:!0,message:"请输入住址",trigger:"blur"},{min:2,max:30,message:"长度在 2 到 30 个字符",trigger:"blur"}],relation:[{required:!0,message:"请输入住址",trigger:"blur"}]},deptRule:{deptName:[{required:!0,message:"请输入部门名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}]},dialogFormVisible:!1,dialogUpdateVisible:!1,dialogSetPrincipalVisible:!1,deptForm:{deptName:"",deptParentId:0},updateDeptForm:{deptId:0,deptName:""},setPrincipalForm:{deptId:0,userIds:[]},options:[],loading:!1,selectNames:[],selectedNames:[]}},watch:{"addUserForm.isHost":{handler:function(e,t){e&&(this.addUserForm.relation="户主"),t&&(this.addUserForm.relation="")},deep:!0,immediate:!0}},methods:{handleEdit:function(){},handleDelete:function(){},handleNodeClick:function(e){this.ids=[],this.ids.push(e.id),this.getUserByDeptId()},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;o["a"].post("user/addUser",t.addUserForm).then((function(e){200==e.data.code&&(t.$message.success("添加成功"),t.addUserPanel=!t.addUserPanel,t.getUserByDeptId())})).catch((function(e){console.log(e)}))}))},resetForm:function(e){this.$refs[e].resetFields()},getUserByDeptId:function(){var e=this;o["a"].post("/user/getUserByDeptId",this.ids).then((function(t){t.data.data&&(e.tableData=t.data.data)}))},append:function(e){this.dialogFormVisible=!0,this.deptForm.deptParentId=e.data.id},submitAddDept:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;o["a"].post("dept/addDept",t.deptForm).catch((function(e){console.log(e)})).then((function(e){200==e.data.code?(t.dialogFormVisible=!1,t.$message({message:"添加成功",type:"success"}),t.deptForm.deptParentId=0,t.deptForm.deptName="",t.getTree()):t.$message.error(e.data.message)}))}))},submitUpdateDept:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;o["a"].post("/dept/updateName",t.updateDeptForm).then((function(e){200==e.data.code?(t.$message.success("修改成功"),t.dialogUpdateVisible=!1,t.getTree()):t.$message.error(e.data.message)})).catch((function(e){console.log(e)}))}))},remove:function(e){var t=this;o["a"].get("/dept/deleteDept/"+e.data.id).then((function(e){200==e.data.code?(t.$message({message:"删除成功",type:"success"}),t.getTree()):t.$message.error(e.data.message)})).catch((function(e){console.log(e)}))},getTree:function(){var e=this;o["a"].get("/dept/getTree").then((function(t){e.deptData=t.data.data,e.allLoading=!1})).catch((function(e){console.log(e)}))},handleDrop:function(e,t,a){var r=this,s=e.data.id,i=t.data.id;"inner"==a?o["a"].get("/dept/updateDept/"+s+"/"+i+"/1").catch((function(e){console.log(e)})).then((function(e){200==e.data.code&&r.getTree()})):(2==e.data.deptLevel&&2==t.data.deptLevel||3==e.data.deptLevel&&3==t.data.deptLevel)&&o["a"].get("/dept/updateDept/"+s+"/"+i+"/2").catch((function(e){console.log(e)})).then((function(e){200==e.data.code&&r.getTree()}))},allowDrop:function(e,t,a){return 2==e.data.deptLevel?1==t.data.deptLevel?"inner"==a:2==t.data.deptLevel&&("prev"===a||"next"===a):1==e.data.deptLevel&&1==t.data.deptLevel?"prev"==a||"next"==a:3==e.data.deptLevel&&(2==t.data.deptLevel?"inner"==a:3==t.data.deptLevel&&("prev"==a||"next"==a))},allowDrag:function(e){return 0!=e.data.deptLevel},setPrincipal:function(e){this.dialogSetPrincipalVisible=!0,this.setPrincipalForm.deptId=e.id,this.getPrincipal(),this.setPrincipalForm.userIds=[],this.options=[]},getPrincipal:function(){var e=this;o["a"].post("/dept/getPrincipal/"+this.setPrincipalForm.deptId).then((function(t){200==t.data.code?e.selectedNames=t.data.data:e.$message.error(t.data.message)})).catch((function(e){console.log(e)}))},closeTag:function(e){var t=this;o["a"].post("/dept/removePrincipal/"+this.setPrincipalForm.deptId+"/"+e).then((function(e){200==e.data.code?(t.$message.success("移除成功"),t.getPrincipal(),t.options=[]):t.$message.error(e.data.message)})).catch((function(e){console.log(e)}))},updateName:function(e){this.dialogUpdateVisible=!0,this.updateDeptForm.deptId=e.id,this.updateDeptForm.deptName=e.label},remoteMethod:function(e){var t=this;this.loading=!0,o["a"].get("/user/search/"+this.setPrincipalForm.deptId+"/"+e).then((function(e){200==e.data.code?t.options=e.data.data:t.$message.error(e.data.message),t.loading=!1})).catch((function(e){console.log(e),t.loading=!1}))},change:function(e){var t=this;o["a"].post("/user/getNameById",{userIds:e}).then((function(e){200==e.data.code?t.selectNames=e.data.data:t.$message.error(e.data.message)})).catch((function(e){console.log(e)}))},submitPrincipalDept:function(){var e=this;o["a"].post("/dept/setPrincipal",this.setPrincipalForm).then((function(t){200==t.data.code?(e.getPrincipal(),e.dialogSetPrincipalVisible=!1,e.selectNames=[],e.$message.success("设置成功")):e.$message.error(t.data.message)})).catch((function(e){console.log(e)}))}},created:function(){this.getTree(),this.getUserByDeptId()}},l=i,n=(a("863c"),a("2877")),d=Object(n["a"])(l,r,s,!1,null,"acfe70fa",null);t["default"]=d.exports},dec2:function(e,t,a){}}]);
//# sourceMappingURL=chunk-2af88ac0.e4e39c68.js.map